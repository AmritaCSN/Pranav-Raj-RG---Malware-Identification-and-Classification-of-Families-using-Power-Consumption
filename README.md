# Malware Identification and Classification of Families Using Power Consumption
This Repository contains about the code implementation of power analysis of multiple malware from Spyware and AgentTesla Family.

## Table of Contents
- [Overview](#Overview)
- [About Tools](#About-Tools)
- [Diagram](#Diagram)
- [Experiment](#Experiment)
- [Result](#Result)
- [Future Work](#Future-Work)


## Overview
 - This project ensures that by monitoring power consumption whether the malware family can be identified or not.
 - 15 malware from each familys are used for this experiment which are sourced from MalwareBazzar.Link: https://bazaar.abuse.ch/browse/
 - Cuckoo SandBox is used as a medium to configure between Host VM and the Guest VM.
 - PowerGadget is used to measure the energy consumption by the malwares and generate dataset.
 - From the dataset generated by PowerGadget a python script is written to generate a graphical representation of the data obtained. 


## About Tools

1. **Power Gadget:**
   It is used to get the run time power consumption data of the system when it is launched.
    - Using this tool it is possible to get details on Frequency, CPU Utilization, Temperature, GPU Utilization, and RAM consumption.
    - When the "Start Log" button is pressed the readings are recorded in a excel format.
    - **Note:** Only works for intel processor systems.
    - link to the tool: https://www.techspot.com/downloads/7172-intel-power-gadget.html

2. **Cuckoo SandBox:**
   It is an leading open source automated malware analysis system.
    - To install this tool follow the official web page https://cuckoo.readthedocs.io/en/latest/installation/


## Diagram

<div align="center">
  <img height="600" src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/MinorFlow.png"  />
</div>

<h4 align="center">
	Fig.1 - Methodology Flowchart .
</h4>

**Explanation:** In "Fig.1" After starting the Cuckoo SandBox, it will open in the locahost. Upload the malware to it and give the run time. There are 3 default timing 60Sec, 120Sec and 300Sec or it is also possible to set custom run time in it. When it starts running, it runs the malware in the Guest VM (Nested VM) at the background. While the malware is running in the background start the PowerGadget simultaneously to get the power consumption data. Every malware data is merged to form a single dataset for 60Sec, 120Sec and 300Sec respectively. using the merged dataset a python code is written to show the result in a graphical manner.

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/CodeFlow.png"  />
</div>

<h4 align="center">
	Fig.2 - Code Flowchart.
</h4>

## Experiment
1. **Cuckoo SandBox:**
   - The power estimation for the default state of the system is taken, where the system is at turbo mode and the brightness is max.
   - The malwares are run for 60Sec, 120Sec and 300Sec as stated in Fig.1 [Diagram](#Diagram) explanation.

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Cuckoo_Running.png"  />
</div>
<h4 align="center">
	Fig.3 - Malware Running in Cuckoo SandBox.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Cuckoo_Summary.png"  />
</div>
<h4 align="center">
	Fig.4 - Result of Malware in Cuckoo SandBox.
</h4>

To run the code follow the following steps:
 - Download the code file named "MinorGraph.ipynb" and Dataset folder.
 - In the code file alter "file_path" as per the dataset file located in your system.
 - Run the code to get the graphical representation of the readings got from PowerGadget.
 - **Note:** The readings from PowerGadget may differ from each systems. When the experiment is replicated it is strongly recommended to conduct the power analysis at the respective systems itself and run the given code.

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Default_Power.png"  />
</div>
<h4 align="center">
	Fig.5 - Graphical Representation of Power Consumption at Default State. .
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Power_60Sec.png"  />
</div>
<h4 align="center">
	Fig.6 - Graphical Representation of Power Consumption of Malware for a Run Time of 60Sec.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Power_120Sec.png"  />
</div>
<h4 align="center">
	Fig.7 - Graphical Representation of Power Consumption of Malware for a Run Time of 120Sec.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav_Raj_RG-Classification-of-Malware-Families-From-Power-Analysis/blob/main/Result/Power_300Sec.png"  />
</div>
<h4 align="center">
	Fig.8 - Graphical Representation of Power Consumption of Malware for a Run Time of 300Sec.
</h4>

## Result
- From [Fig.5](#Fig.5) graph it can be seen that the default state consumes less power with a max power consumption of 1.3 watts with a average power consumption of 0.4 watts/ms compare to others.
- From [Fig.6](#Fig.6), [Fig.7](#Fig.7) and [Fig.8](#Fig.8) graph the malware consumes more power than default state with max power consumption of 2 watts with average power consumption of 0.55 - 0.60 watts/ms.
- Overall from the output of the project, it is found that most of the spyware family malwares can be identified between 0.55-0.60 watts/sec when a power analysis is conducted.
 

## Future Work

To create a web page where the files are uploaded to it and display the details of the files and differentiate it with malwares.
