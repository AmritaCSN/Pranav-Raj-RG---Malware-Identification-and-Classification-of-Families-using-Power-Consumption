# Malware Identification and Classification of Families Using Power Consumption
This Repository contains about the code implementation of power analysis of multiple malware from Spyware and AgentTesla Family.

## Table of Contents
- [Overview](#Overview)
- [About Tools](#About-Tools)
- [Flowchart](#Flowchart)
- [Experiment](#Experiment)
- [Result](#Result)
- [Future Work](#Future-Work)


## Overview
 - This project ensures that by monitoring power consumption whether the malware family can be identified or not.
 - 15 malware from each familys are used for this experiment which are sourced from MalwareBazzar. Link: https://bazaar.abuse.ch/browse/
 - Cuckoo SandBox is used as a medium to configure between Host VM and the Guest VM.
 - PowerGadget is used to measure the energy consumption by the malwares and generate dataset.
 - From the dataset generated by PowerGadget a python script is written to generate a graphical representation of the data obtained. 


## About Tools

1. **Power Gadget:**
   It is used to get the run time power consumption data of the system when it is launched.
    - Using this tool it is possible to get details on Frequency, CPU Utilization, Temperature, GPU Utilization, and RAM consumption.
    - When the "Start Log" button is pressed the readings are recorded in a excel format.
    - **Note:** Only works for intel processor systems.
    - link to the tool: https://www.techspot.com/downloads/7172-intel-power-gadget.html

2. **Cuckoo SandBox:**
   It is an leading open source automated malware analysis system.
    - To install this tool follow the official web page https://cuckoo.readthedocs.io/en/latest/installation/


## Flowchart

<div align="center">
  <img height="600" src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Images/Methodology.png"  />
</div>

<h4 align="center">
	Fig.1 - Methodology Flowchart .
</h4>

**Explanation:** In "Fig.1" After starting the Cuckoo SandBox, it will open in the locahost in Host VM. Upload the malware to it and give the run time. There are 3 default timing 60Sec, 120Sec and 300Sec or it is also possible to set custom run time in it. When it starts running, it runs the malware in the Guest VM (Nested VM) at the background. While the malware is running in the background start the PowerGadget simultaneously to get the power consumption data. Every malware data is merged to form a dataset for each family respectively. Using the merged dataset a python code is written to show the result in a graphical manner.

## Experiment
   - Run MalwareDetection.ipynb to detect the presence of malware in the system.
   - The power estimation for the system is taken, where the system is at turbo mode and the brightness is max.
   - The malwares were run for a period of 300Sec.

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Images/Cuckoo_Running.png"  />
</div>
<h4 align="center">
	Fig.2 - Malware Running in Cuckoo SandBox.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Images/Cuckoo_Summary.png"  />
</div>
<h4 align="center">
	Fig.3 - Result of Malware in Cuckoo SandBox.
</h4>

To run the code follow the following steps:
 - Download the code file named "MajorProjectGraph.ipynb" and Dataset folder.
 - In the code file alter "file_path" as per the dataset file located in your system.
 - The dataset folder contains 4 datasets.
   	- AT-Graph.csv represents the power estimation collected from AgentTesla Family.
   	- Spy-Graph.csv represents the power estimation collected from Spyware Family.
   	- AT_Vs_Spy.csv represents the power estimation comparision between AgentTesla and Spyware family.
   	- SHA256 and category.csv contains the information of SHA256 and the catagory of thte malware which it belongs to. this dataset is developed by BlueHexagon and UIUC.
 - Run the code to get the graphical representation of the readings got from PowerGadget.
 - **Note:** The readings from PowerGadget may differ from each systems. When the experiment is replicated it is strongly recommended to conduct the power analysis using PowerGadget tool at the respective systems itself.

## Result


- From [Fig.4](#Fig.4) graph it can be seen that the AgentTesla Family consumes the most power with a max power consumption ranging above of 1.75 watts with a average power consumption of 0.83 watts/ms compare to others.
- From [Fig.5](#Fig.5) graph it can be seen that the Spyware Family consumes enery ranging from 0.5 to 1.5 watts averaging to 0.60.
- [Fig.6](#Fig.6) graph shows that the enery comparision between is significantly varies from each family indicating that the malware families can be categorized using power analysis method.


  
<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Result/AT-Graph.png"  />
</div>
<h4 align="center">
	Fig.4 - Graphical Representation of Power Consumption of AgentTesla Family.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Result/Spy-Graph.png"  />
</div>
<h4 align="center">
	Fig.5 - Graphical Representation of Power Consumption of Spyware Family.
</h4>

<div align="center">
  <img src="https://github.com/AmritaCSN/Pranav-Raj-RG---Malware-Identification-and-Classification-of-Families-using-Power-Consumption/blob/main/Result/Spy VS AT-Graph.png"  />
</div>
<h4 align="center">
	Fig.6 - Graphical Representation of Power Consumption Comparation b/w Spyware and AgentTesla Family.
</h4>


- Overall from the output of the project, it is found that on an average, most of the spyware family malwares can be identified between 0.55-0.60 watts/sec and AgentTesla family identified between 0.75-0.87 when an power analysis is conducted.
 

## Future Work
- To create a web page for identifying malware where, the files are uploaded to it and display the details of the files and differentiate it with malwares.
- To analyse many more malware samples.

